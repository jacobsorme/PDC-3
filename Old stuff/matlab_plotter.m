clf;
% Threads, time and stdev for 10 repetitions
% dft_times = [
% 	1,	11.357410,	0.012863;
% 	2,	5.801143,	0.011374;
% 	4,	3.176952,	0.011562;
% 	8,	1.805324,	0.002741;
% 	16,	0.937652,	0.000223;
% 	32,	0.471189,	0.000311;
% ];

dft_times = [
        1,      10.187428,      ;
        2,      5.231638,       ;
        3,      3.767636,       ;
        4,      2.903722,       ;
        5,      2.391003,       ;
        6,      2.057695,       ;
        7,      1.827137,       ;
        8,      1.655405,       ;
        9,      1.480260,       ;
        10,     1.329083,       ;
        11,     1.208535,       ;
        12,     1.108324,       ;
        13,     1.025335,       ;
        14,     0.952175,       ;
        15,     0.889104,       ;
        16,     0.834259,       ;
        17,     0.784167,       ;
        18,     0.740999,       ;
        19,     0.700743,       ;
        20,     0.663752,       ;
        21,     0.631842,       ;
        22,     0.602633,       ;
        23,     0.574809,       ;
        24,     0.549422,       ;
        25,     0.528321,       ;
        26,     0.514079,       ;
        27,     0.495948,       ;
        28,     0.477926,       ;
        29,     0.461896,       ;
        30,     0.447164,       ;
        31,     0.433595,       ;
        32,     0.420851,       ;
];


threads = dft_times(:,1);
times = dft_times(:,2);

plot(threads, times,'*');
hold on;

numthreads = length(threads)

X = [1./threads ones(numthreads, 1)];

% X * beta = times

beta = (X'*X)\(X'*times);
xv = 1:0.01:32;
yv = beta(1)./xv + beta(2);
plot(xv,yv);
leg2 = sprintf("$Interpolation: \\hat{y} = \\frac{%.2f}{x} + %.2f$", beta(1), beta(2));
legend(["Measured values", leg2], 'Interpreter', 'latex', 'FontSize', 16);
xlabel("Threads");
ylabel("DFT execution time (s)");

%%
sum_results = [
        0.014284,               0.010813,               0.010223,               0.014421,               0.024948,               0.052826,       ;
        0.028176,               0.017915,               0.013565,               0.016757,               0.026204,               0.052805,       ;
        0.042088,               0.024751,               0.017342,               0.018543,               0.027013,               0.053962,       ;
        0.056193,               0.032256,               0.021689,               0.020716,               0.028475,               0.054023,       ;
        0.070012,               0.039224,               0.025387,               0.022875,               0.029617,               0.055338,       ;
        0.084042,               0.045888,               0.029159,               0.025260,               0.030650,               0.056096,       ;
];

x = [5000 10000 15000 20000 25000 30000];
y = [1 2 4 8 16 32];

surf(y,x,sum_results);
ylabel("Size");
xlabel("Threads");
zlabel("Time (s)");
%%
clf;
sum_results_5000 = [
	0.013945,	0.072942,	0.049020,	0.014702,	0.017588,	0.014284,	0.014275;
	0.013940,	0.282527,	0.199661,	0.014230,	0.013158,	0.011477,	0.010758;
	0.014019,	0.768475,	0.256442,	0.015204,	0.011704,	0.010628,	0.010195;
	0.013951,	1.472492,	0.317436,	0.017627,	0.016150,	0.014579,	0.014524;
	0.013973,	2.204586,	0.388292,	0.024114,	0.027212,	0.025322,	0.025250;
	0.013962,	1.657447,	0.316498,	0.054176,	0.047457,	0.052524,	0.052896;
];
sum_results_30000 = [
	0.083695,	0.434631,	0.292757,	0.085580,	0.101289,	0.084008,	0.083862;
	0.083705,	1.937508,	1.322114,	0.067833,	0.054908,	0.046294,	0.045817;
	0.083588,	5.749141,	1.539897,	0.067883,	0.035067,	0.029740,	0.029365;
	0.083502,	8.328906,	1.769262,	0.070720,	0.030697,	0.025732,	0.025658;
	0.083650,	13.036382,	1.871121,	0.064565,	0.034153,	0.029540,	0.030938;
	0.083619,	7.477123,	1.521077,	0.073003,	0.052861,	0.054859,	0.055942;
];
bar_labels = categorical({'1', '2', '4', '8', '16', '32'});
bar_labels = reordercats(bar_labels,{'1', '2', '4', '8', '16', '32'});
barh(bar_labels,sum_results_5000(:,[1,4,5,6,7]));
xlabel("Time");
ylabel("Threads");

legend("serial", "local (array)", "padded", "private (for)", "reduction");